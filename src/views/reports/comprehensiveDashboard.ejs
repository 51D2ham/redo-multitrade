<%
/* Chart data setup */
var chartLabels = [];
var chartData = [];
var chartOrderData = [];
if (typeof report !== 'undefined' && report && report.monthlyTrend && report.monthlyTrend.length) {
  chartLabels = report.monthlyTrend.map(row => ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][row.month-1]);
  chartData = report.monthlyTrend.map(row => row.totalRevenue);
  chartOrderData = report.monthlyTrend.map(row => row.totalOrders);
} else {
  chartLabels = ["Jan", "Feb", "Mar", "Apr", "May", "Jun"];
  chartData = [0,0,0,0,0,0];
  chartOrderData = [0,0,0,0,0,0];
}
%>
<%- include('../partials/header.ejs', { title: title }) %>

<!-- Main Content -->
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50">
  <!-- Hidden Chart Data -->
  <div id="chart-data-holder" 
       data-labels='<%= JSON.stringify(chartLabels) %>' 
       data-revenue='<%= JSON.stringify(chartData) %>'
       data-orders='<%= JSON.stringify(chartOrderData) %>'
       class="hidden"></div>

  <div class="max-w-8xl mx-auto px-4 py-8">
    <!-- Page Header -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-8">
      <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center gap-6">
        <!-- Title & Search -->
        <div class="flex-grow">
          <h1 class="text-2xl font-bold text-gray-900">Business Analytics Dashboard</h1>
          <p class="text-gray-600 mt-2">Comprehensive overview of sales, inventory, and performance metrics</p>
          
          <!-- Search Bar -->
          <div class="mt-6">
            <form id="filtersForm" class="flex gap-3 items-end" method="get" action="/admin/reports/comprehensive">
              <!-- Hidden start/end to be populated by flatpickr -->
              <input type="hidden" name="startDate" value="<%= startDate || '' %>" />
              <input type="hidden" name="endDate" value="<%= endDate || '' %>" />
              <div>
                <label class="text-xs text-gray-500">Date Range</label>
                <input type="text" id="dateRange" name="dateRange" class="mt-1 px-3 py-2 border rounded-lg" placeholder="Select date range" value="<%= startDate && endDate ? `${startDate} to ${endDate}` : '' %>" />
              </div>
              <div>
                <label class="text-xs text-gray-500">Low stock threshold</label>
                <input type="number" name="lowStockThreshold" min="0" value="<%= lowStockThreshold || 5 %>" class="mt-1 w-28 px-3 py-2 border rounded-lg" />
              </div>
              <div>
                <button type="submit" class="mt-1 px-4 py-2 bg-blue-600 text-white rounded-lg">Apply</button>
              </div>
              <div class="ml-4">
                <input type="text" id="searchInput" 
                  class="pl-10 pr-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-400 focus:border-blue-400" 
                  placeholder="Search products, SKUs, or orders..."
                  value="<%= search || '' %>">
              </div>
            </form>
          </div>
        </div>

        <!-- Filters -->
        <div class="flex flex-col sm:flex-row gap-4 items-end">
          <!-- Sort Order -->
          <div class="w-40">
            <label class="block text-sm font-medium text-gray-700 mb-1">Sort By</label>
            <select id="sortOrder" class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 bg-white">
              <option value="date_desc" <%= sortBy === 'date_desc' ? 'selected' : '' %>>Latest First</option>
              <option value="date_asc" <%= sortBy === 'date_asc' ? 'selected' : '' %>>Oldest First</option>
              <option value="value_desc" <%= sortBy === 'value_desc' ? 'selected' : '' %>>Highest Value</option>
              <option value="value_asc" <%= sortBy === 'value_asc' ? 'selected' : '' %>>Lowest Value</option>
            </select>
          </div>

          <!-- Export Button -->
          <div class="relative">
            <button id="exportBtn" 
              class="px-4 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors flex items-center gap-2">
              <i class="fas fa-download"></i> Export
            </button>
            <div id="exportMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-gray-100 z-10">
              <div class="p-2">
                <a href="/admin/reports/comprehensive/excel?<%= new URLSearchParams({
                  startDate: startDate || '',
                  endDate: endDate || '',
                  year: year || '',
                  lowStockThreshold: lowStockThreshold || '',
                  search: search || '',
                  sortBy: sortBy || ''
                }).toString() %>" 
                  class="flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-blue-50 rounded-lg">
                  <i class="fas fa-file-excel text-green-600"></i> Export to Excel
                </a>
                <a href="/admin/reports/comprehensive/csv?<%= new URLSearchParams({
                  startDate: startDate || '',
                  endDate: endDate || '',
                  year: year || '',
                  lowStockThreshold: lowStockThreshold || '',
                  search: search || '',
                  sortBy: sortBy || ''
                }).toString() %>" 
                  class="flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-blue-50 rounded-lg">
                  <i class="fas fa-file-csv text-blue-600"></i> Export to CSV
                </a>
              </div>
            </div>
          </div>
          
          <button onclick="toggleFilters()" class="w-full sm:w-auto px-4 py-2.5 bg-white border border-gray-200 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300 flex items-center justify-center gap-2">
            <i class="fas fa-filter"></i>
            Filters
            <span class="bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full text-xs font-medium" id="activeFiltersCount">0</span>
          </button>
        </div>
      </div>

    <!-- Flash Messages -->
    <% if (success && success.length) { %>
      <div class="mb-6 p-4 rounded-lg bg-green-50 border border-green-200 text-green-800">
        <% success.forEach(msg => { %>
          <div class="flex items-center gap-2">
            <i class="fas fa-check-circle"></i>
            <%= msg %>
          </div>
        <% }) %>
      </div>
    <% } %>
    <% if (error && error.length) { %>
      <div class="mb-6 p-4 rounded-lg bg-red-50 border border-red-200 text-red-800">
        <% error.forEach(msg => { %>
          <div class="flex items-center gap-2">
            <i class="fas fa-exclamation-circle"></i>
            <%= msg %>
          </div>
        <% }) %>
      </div>
    <% } %>

    <!-- Analytics Grid -->
    <div class="grid grid-cols-12 gap-8 mb-8">
      <!-- KPI Cards Row -->
      <div class="col-span-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Revenue Card -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg transition-all duration-300">
          <div class="flex items-center justify-between mb-4">
            <div class="p-3 bg-blue-100 rounded-2xl text-blue-600">
              <i class="fas fa-rupee-sign text-xl"></i>
            </div>
            <div class="text-right">
              <p class="text-sm text-gray-600 font-medium mb-1">Total Revenue</p>
              <h3 class="text-2xl font-bold text-gray-900">₹<%= report.revenueSummary?.totalRevenue?.toLocaleString('en-IN', { minimumFractionDigits: 2 }) || '0.00' %></h3>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-500">
              <%= report.revenueSummary?.totalOrders || 0 %> Total Orders
            </span>
            <span class="text-sm text-blue-600 font-medium">
              <%= report.monthlyTrend?.[report.monthlyTrend.length - 1]?.totalOrders || 0 %> This Month
            </span>
          </div>
        </div>
        <!-- Average Order Value Card -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg transition-all duration-300 group">
          <div class="flex items-center justify-between mb-4">
            <div class="p-3 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl text-white shadow-lg shadow-green-100 group-hover:scale-110 transition-transform">
              <i class="fas fa-shopping-cart text-xl"></i>
            </div>
            <div class="text-right">
              <p class="text-sm text-gray-600 font-medium mb-1">Average Order Value</p>
              <h3 class="text-2xl font-bold text-gray-900">₹<%= report.aov?.averageOrderValue?.toLocaleString('en-IN', { minimumFractionDigits: 2 }) || '0.00' %></h3>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-500">From <%= report.aov?.orderCount || 0 %> orders</span>
            <% const aovGrowth = 8; // Calculate this from your data %>
            <span class="flex items-center gap-1 text-sm <%= aovGrowth >= 0 ? 'text-green-600' : 'text-red-600' %>">
              <i class="fas fa-<%= aovGrowth >= 0 ? 'arrow-up' : 'arrow-down' %>"></i>
              <%= Math.abs(aovGrowth) %>%
            </span>
          </div>
        </div>

        <!-- Low Stock Card -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg transition-all duration-300 group">
          <div class="flex items-center justify-between mb-4">
            <div class="p-3 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-2xl text-white shadow-lg shadow-yellow-100 group-hover:scale-110 transition-transform">
              <i class="fas fa-exclamation-triangle text-xl"></i>
            </div>
            <div class="text-right">
              <p class="text-sm text-gray-600 font-medium mb-1">Low Stock Alerts</p>
              <h3 class="text-2xl font-bold text-gray-900"><%= report.lowStockAlerts ? report.lowStockAlerts.length : 0 %></h3>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm text-gray-500">Threshold: <%= lowStockThreshold %> units</span>
            <a href="#lowStockSection" class="text-sm text-yellow-600 hover:text-yellow-700">View Details →</a>
          </div>
        </div>

        <!-- Total Products Card -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-lg transition-all duration-300 group">
          <div class="flex items-center justify-between mb-4">
            <div class="p-3 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl text-white shadow-lg shadow-purple-100 group-hover:scale-110 transition-transform">
              <i class="fas fa-boxes text-xl"></i>
            </div>
            <div class="text-right">
              <p class="text-sm text-gray-600 font-medium mb-1">Total Products</p>
              <h3 class="text-2xl font-bold text-gray-900"><%= report.totalProducts || 0 %></h3>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm text-green-600"><%= report.activeProducts || 0 %> active</span>
            <span class="text-sm text-yellow-600"><%= report.draftProducts || 0 %> draft</span>
          </div>
        </div>
      </div>

      <!-- Enhanced Metrics Row -->
      <div class="col-span-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Stock Status Card -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
          <h4 class="text-sm font-medium text-gray-600 mb-3 flex items-center gap-2">
            <i class="fas fa-warehouse text-blue-500"></i> Stock Status
          </h4>
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-sm text-green-600">In Stock:</span>
              <span class="font-semibold"><%= report.inStockVariants || 0 %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-yellow-600">Low Stock:</span>
              <span class="font-semibold"><%= report.lowStockVariants || 0 %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-red-600">Out of Stock:</span>
              <span class="font-semibold"><%= report.outOfStockVariants || 0 %></span>
            </div>
          </div>
        </div>

        <!-- Sales Metrics Card -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
          <h4 class="text-sm font-medium text-gray-600 mb-3 flex items-center gap-2">
            <i class="fas fa-chart-line text-green-500"></i> Sales Metrics
          </h4>
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-sm text-gray-600">Items Sold:</span>
              <span class="font-semibold"><%= report.salesMetrics?.totalItemsSold || 0 %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-600">Unique Products:</span>
              <span class="font-semibold"><%= report.salesMetrics?.uniqueProductCount || 0 %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-600">Avg Items/Order:</span>
              <span class="font-semibold"><%= report.salesMetrics?.avgItemsPerOrder || 0 %></span>
            </div>
          </div>
        </div>

        <!-- Financial Card -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
          <h4 class="text-sm font-medium text-gray-600 mb-3 flex items-center gap-2">
            <i class="fas fa-money-bill-wave text-purple-500"></i> Financial
          </h4>
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-sm text-gray-600">Stock Value:</span>
              <span class="font-semibold">₹<%= (report.stockValue || 0).toLocaleString('en-IN') %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-600">Max Order:</span>
              <span class="font-semibold">₹<%= (report.salesMetrics?.maxOrderValue || 0).toLocaleString('en-IN') %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-600">Min Order:</span>
              <span class="font-semibold">₹<%= (report.salesMetrics?.minOrderValue || 0).toLocaleString('en-IN') %></span>
            </div>
          </div>
        </div>

        <!-- Product Breakdown Card -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
          <h4 class="text-sm font-medium text-gray-600 mb-3 flex items-center gap-2">
            <i class="fas fa-cubes text-orange-500"></i> Product Breakdown
          </h4>
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-sm text-green-600">Active:</span>
              <span class="font-semibold"><%= report.activeProducts || 0 %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-yellow-600">Draft:</span>
              <span class="font-semibold"><%= report.draftProducts || 0 %></span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-600">Variants:</span>
              <span class="font-semibold"><%= report.totalVariants || 0 %></span>
            </div>
          </div>
        </div>
      </div>
        
      <!-- Sales Performance Section -->
      <div class="col-span-12 lg:col-span-8 space-y-8">
        <!-- Monthly Sales Trend Chart -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-semibold text-gray-900">Monthly Sales Trend</h3>
            <div class="flex items-center gap-4">
              <select id="trendMetric" class="text-sm border-gray-200 rounded-lg focus:ring-blue-500">
                <option value="revenue">Revenue</option>
                <option value="orders">Orders</option>
              </select>
            </div>
          </div>
          <div class="h-80">
            <canvas id="salesTrendChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Top Products & Categories -->
      <div class="col-span-12 lg:col-span-4 space-y-8">
        <!-- Top Products Card -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Top Products</h3>
          <div class="space-y-4">
            <% (report.topProducts || []).slice(0, 5).forEach((product, index) => { %>
              <div class="flex items-center gap-4 p-3 bg-gray-50 rounded-xl">
                <div class="flex-shrink-0 w-12 h-12 rounded-lg bg-white p-2 flex items-center justify-center">
                  <span class="text-xl font-bold text-gray-400">#<%= index + 1 %></span>
                </div>
                <div class="flex-grow min-w-0">
                  <p class="font-medium text-gray-900 truncate"><%= product.name %></p>
                  <p class="text-sm text-gray-500"><%= product.totalQuantity %> units sold</p>
                </div>
                <div class="text-right">
                  <p class="font-semibold text-blue-600">₹<%= product.totalRevenue?.toLocaleString('en-IN', { maximumFractionDigits: 0 }) || 0 %></p>
                </div>
              </div>
            <% }) %>
          </div>
        </div>

        <!-- Sales by Category Card -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Sales by Category</h3>
          <div class="space-y-3">
            <% (report.salesByCat || []).slice(0,5).forEach(cat => { %>
              <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                <div>
                  <p class="text-sm font-medium text-gray-900"><%= cat.categoryName || 'Unknown' %></p>
                  <p class="text-xs text-gray-500"><%= cat.totalQuantity || 0 %> items</p>
                </div>
                <div class="text-right">
                  <p class="font-semibold text-blue-600">₹<%= (cat.totalRevenue || 0).toLocaleString('en-IN', { maximumFractionDigits: 0 }) %></p>
                </div>
              </div>
            <% }) %>
          </div>
        </div>
      </div>
    </div>

    <!-- Advanced Filters Panel -->
    <div id="filtersPanel" class="hidden mb-8">
      <form id="advancedFiltersForm" action="/admin/reports/comprehensive" method="GET" class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- Date Filters -->
          <div class="space-y-6">
            <h3 class="font-semibold text-gray-800 flex items-center gap-2">
              <i class="fas fa-calendar text-blue-600"></i> Date Filters
            </h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Year</label>
                <select id="yearSelect" name="year" 
                  class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all">
                  <% for (let y = 2020; y <= new Date().getFullYear(); y++) { %>
                    <option value="<%= y %>" <%= y === year ? 'selected' : '' %>><%= y %></option>
                  <% } %>
                </select>
              </div>
            </div>
          </div>

          <!-- Inventory Filters -->
          <div class="space-y-6">
            <h3 class="font-semibold text-gray-800 flex items-center gap-2">
              <i class="fas fa-box text-blue-600"></i> Inventory Filters
            </h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Stock Threshold</label>
                <div class="flex gap-4">
                  <div class="flex-1">
                    <input type="number" name="lowStockThreshold" min="0" 
                      class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all" 
                      placeholder="Low stock threshold" 
                      value="<%= lowStockThreshold || 5 %>" />
                  </div>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Product Status</label>
                <select name="productStatus" class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all">
                  <option value="">All Statuses</option>
                  <option value="in_stock">In Stock</option>
                  <option value="low_stock">Low Stock</option>
                  <option value="out_of_stock">Out of Stock</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Advanced Filters -->
          <div class="space-y-6">
            <h3 class="font-semibold text-gray-800 flex items-center gap-2">
              <i class="fas fa-sliders-h text-blue-600"></i> Advanced Filters
            </h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Order Status</label>
                <select name="orderStatus" multiple class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all">
                  <option value="Completed">Completed</option>
                  <option value="Confirmed">Confirmed</option>
                  <option value="Delivered">Delivered</option>
                  <option value="Shipped">Shipped</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Minimum Order Value</label>
                <input type="number" name="minOrderValue" min="0" 
                  class="w-full px-4 py-2.5 rounded-xl border border-gray-200 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all" 
                  placeholder="Min order value" />
              </div>
            </div>
          </div>
        </div>

        <!-- Filter Actions -->
        <div class="flex items-center justify-end gap-3 mt-8 pt-6 border-t">
          <button type="reset" class="px-4 py-2 text-gray-600 hover:text-gray-800">
            Reset Filters
          </button>
          <button type="submit" class="px-6 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:shadow-lg transition-all duration-300 flex items-center gap-2">
            <i class="fas fa-sync-alt"></i> Apply Filters
          </button>
        </div>
      </form>
    </div>

    <!-- Low Stock Section -->
    <div id="lowStockSection" class="bg-white rounded-2xl shadow-sm border border-gray-100 mb-8">
      <div class="px-6 py-4 border-b flex items-center justify-between">
        <div>
          <h2 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
            <i class="fas fa-exclamation-triangle text-yellow-500"></i>
            Low Stock Products
          </h2>
          <p class="text-sm text-gray-500 mt-1">Products with stock below <%= lowStockThreshold %> units</p>
        </div>
        <a href="/admin/v1/inventory/low-stock" class="px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 flex items-center gap-1">
          Full Report <i class="fas fa-arrow-right text-xs"></i>
        </a>
      </div>

      <div class="p-6">
        <% if (report.lowStockAlerts && report.lowStockAlerts.length > 0) { %>
          <div class="overflow-x-auto">
            <table class="min-w-full">
              <thead>
                <tr class="text-left text-sm font-medium text-gray-500 border-b">
                  <th class="pb-3 pl-4">Product</th>
                  <th class="pb-3">Current Stock</th>
                  <th class="pb-3">Last Sale</th>
                  <th class="pb-3">Action</th>
                </tr>
              </thead>
              <tbody class="divide-y">
                <% report.lowStockAlerts.forEach((alert, index) => { 
                  const lastSale = report.recentMovements?.find(m => m.variantSku === alert.sku && m.type === 'sale');
                %>
                  <tr class="text-sm">
                    <td class="py-4 pl-4">
                      <div>
                        <p class="font-medium text-gray-900"><%= alert.title || alert.productTitle || 'Unknown Product' %></p>
                        <p class="text-gray-500">SKU: <%= alert.sku || alert.variantSku || 'N/A' %></p>
                      </div>
                    </td>
                    <td class="py-4">
                      <div class="flex items-center gap-2">
                        <span class="px-2.5 py-1 rounded-lg <%= (alert.stock || alert.remainingStock || 0) <= 2 ? 'bg-red-50 text-red-700' : 'bg-yellow-50 text-yellow-700' %> font-medium">
                          <%= alert.stock || alert.remainingStock || 0 %> units
                        </span>
                      </div>
                    </td>
                    <td class="py-4">
                      <% if (lastSale) { %>
                        <div>
                          <p class="text-gray-900"><%= new Date(lastSale.createdAt).toLocaleDateString() %></p>
                          <p class="text-gray-500"><%= Math.abs(lastSale.quantity) %> units sold</p>
                        </div>
                      <% } else { %>
                        <span class="text-gray-500">No recent sales</span>
                      <% } %>
                    </td>
                    <td class="py-4">
                      <a href="/admin/v1/inventory/restock/<%= alert.productId %>?sku=<%= alert.sku || alert.variantSku %>" 
                         class="px-3 py-1.5 text-sm font-medium text-indigo-600 hover:text-indigo-700 border border-indigo-200 rounded-lg hover:bg-indigo-50 transition-colors">
                        Restock Now
                      </a>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <div class="text-center py-8">
            <div class="mb-4">
              <i class="fas fa-check-circle text-4xl text-green-500"></i>
            </div>
            <p class="text-gray-600">All products are above threshold levels</p>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Recent Movements -->
    <div class="bg-white rounded-xl shadow-sm border mb-8">
      <div class="px-6 py-4 border-b bg-gray-50 rounded-t-xl flex items-center justify-between">
        <h2 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
          <i class="fas fa-history text-blue-500"></i>
          Recent Movements
        </h2>
        <a href="/admin/v1/inventory/movements" class="text-blue-600 hover:text-blue-800 text-sm font-medium">View All →</a>
      </div>
      <div class="p-6">
        <% if (report.recentMovements && report.recentMovements.length > 0) { %>
          <div class="space-y-4">
            <% report.recentMovements.slice(0, 5).forEach(movement => { %>
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center">
                  <div class="w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center mr-3">
                    <% if (movement.product?.thumbnail) { %>
                      <img src="<%= movement.product.thumbnail %>" alt="" class="w-8 h-8 object-cover rounded">
                    <% } else { %>
                      <i class="fas fa-cube text-gray-400"></i>
                    <% } %>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900"><%= movement.product?.title || 'Unknown Product' %></p>
                    <p class="text-sm text-gray-600">SKU: <%= movement.variantSku %></p>
                  </div>
                </div>
                <div class="text-right">
                  <p class="text-sm font-medium">
                    <span class="<%= movement.type === 'sale' ? 'text-red-600' : 'text-green-600' %>">
                      <%= movement.type === 'sale' ? '-' : '+' %><%= movement.quantity %>
                    </span>
                  </p>
                  <p class="text-xs text-gray-500"><%= new Date(movement.createdAt).toLocaleDateString() %></p>
                </div>
              </div>
            <% }) %>
          </div>
        <% } else { %>
          <p class="text-gray-500 text-center py-8">No recent movements</p>
        <% } %>
      </div>
    </div>

    <!-- Recent Orders Section -->
    <div class="bg-white rounded-xl shadow-sm border mb-8">
      <div class="px-6 py-4 border-b bg-green-50 rounded-t-xl flex items-center justify-between">
        <h2 class="text-lg font-semibold text-green-700 flex items-center gap-2">
          <i class="fas fa-shopping-bag text-green-500"></i>
          Recent Orders
        </h2>
        <a href="/admin/orders" class="text-green-600 hover:text-green-800 text-sm font-medium">View All →</a>
      </div>
      <div class="p-6">
        <% if (report.recentOrders && report.recentOrders.length > 0) { %>
          <div class="space-y-4">
            <% report.recentOrders.slice(0, 5).forEach(order => { %>
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center">
                  <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                    <i class="fas fa-receipt text-green-600"></i>
                  </div>
                  <div>
                    <p class="font-medium text-gray-900">Order #<%= order.orderId || order._id %></p>
                    <p class="text-sm text-gray-600"><%= order.customerName || 'Customer' %> • <%= order.items?.length || 0 %> items</p>
                  </div>
                </div>
                <div class="text-right">
                  <p class="font-semibold text-green-600">₹<%= (order.totalAmount || 0).toLocaleString('en-IN') %></p>
                  <p class="text-xs text-gray-500"><%= new Date(order.createdAt).toLocaleDateString() %></p>
                </div>
              </div>
            <% }) %>
          </div>
        <% } else { %>
          <div class="text-center py-8">
            <div class="mb-4">
              <i class="fas fa-shopping-bag text-4xl text-gray-300"></i>
            </div>
            <p class="text-gray-500">No recent orders</p>
          </div>
        <% } %>
      </div>
    </div>

    <!-- Sales Overview Section -->
    <div class="bg-white rounded-xl shadow-sm border mb-8">
      <div class="px-6 py-4 border-b bg-blue-50 rounded-t-xl flex items-center gap-2">
        <i class="fas fa-chart-line text-blue-500"></i>
        <h2 class="text-lg font-semibold text-blue-700">Sales Overview</h2>
      </div>
      <div class="p-6">
        <% if (!report.monthlyTrend?.length) { %>
          <div class="text-center py-8 text-gray-400 italic">No sales data found</div>
        <% } else { %>
          <!-- Summary Cards -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="bg-blue-50 rounded-lg p-6 flex flex-col items-center">
              <div class="text-sm text-blue-600 mb-1">Total Revenue</div>
              <div class="text-xl font-bold text-blue-800">
                ₹<%= (report.revenueSummary?.totalRevenue || 0).toLocaleString('en-IN', { maximumFractionDigits: 0 }) %>
              </div>
            </div>
            <div class="bg-green-50 rounded-lg p-6 flex flex-col items-center">
              <div class="text-sm text-green-600 mb-1">Total Orders</div>
              <div class="text-xl font-bold text-green-800">
                <%= report.revenueSummary?.totalOrders || 0 %>
              </div>
            </div>
            <div class="bg-purple-50 rounded-lg p-6 flex flex-col items-center">
              <div class="text-sm text-purple-600 mb-1">Items Sold</div>
              <div class="text-xl font-bold text-purple-800">
                <%= report.salesMetrics?.totalItemsSold || 0 %>
              </div>
            </div>
          </div>
        <% } %>
      </div>
    </div>

  <!-- Chart Data Holder for JS (single instance at top) -->

    <%- include('../partials/footer.ejs') %>
  </div>
</div>
<!-- Required Scripts -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon"></script>
<script nonce="<%= (typeof cspNonce !== 'undefined' ? cspNonce : '') %>">
  // Initialize date picker
  flatpickr('#dateRange', {
    mode: 'range',
    dateFormat: 'Y-m-d',
    maxDate: 'today',
    disableMobile: true,
    static: true,
    onChange: function(selectedDates) {
      if (selectedDates.length === 2) {
        const start = selectedDates[0].toISOString().split('T')[0];
        const end = selectedDates[1].toISOString().split('T')[0];
        const startInput = document.querySelector('input[name="startDate"]');
        const endInput = document.querySelector('input[name="endDate"]');
        if (startInput) startInput.value = start;
        if (endInput) endInput.value = end;
      }
    }
  });

  // Removed unused salesChart initialization (we use salesTrendChart below)

  // Search handler with debounce
  let searchTimeout;
  const searchEl = document.getElementById('searchInput');
  if (searchEl) searchEl.addEventListener('input', e => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      const searchParams = new URLSearchParams(window.location.search);
      searchParams.set('search', e.target.value);
      window.location.search = searchParams.toString();
    }, 500);
  });

  // Sort handler
  const sortEl = document.getElementById('sortOrder');
  if (sortEl) sortEl.addEventListener('change', e => {
    const searchParams = new URLSearchParams(window.location.search);
    searchParams.set('sortBy', e.target.value);
    window.location.search = searchParams.toString();
  });

  // Export menu toggle
  const exportBtnEl = document.getElementById('exportBtn');
  const exportMenuEl = document.getElementById('exportMenu');
  if (exportBtnEl && exportMenuEl) exportBtnEl.addEventListener('click', () => {
    exportMenuEl.classList.toggle('hidden');
  });

  // Close export menu on outside click
  document.addEventListener('click', e => {
    const exportMenu = document.getElementById('exportMenu');
    const exportBtn = document.getElementById('exportBtn');
    if (exportMenu && exportBtn && !exportMenu.contains(e.target) && !exportBtn.contains(e.target)) {
      exportMenu.classList.add('hidden');
    }
  });
  // Toggle advanced filters panel
  function toggleFilters() {
    const panel = document.getElementById('filtersPanel');
    if (!panel) return;
    panel.classList.toggle('hidden');
    // update button badge
    updateActiveFiltersCount();
  }
  // Update active filters count
  function updateActiveFiltersCount() {
    const form = document.getElementById('filtersForm');
    if (!form) return;
    const formData = new FormData(form);
    let activeCount = 0;
    for (let [key, value] of formData.entries()) {
      if (value && value !== '') activeCount++;
    }
    const badge = document.getElementById('activeFiltersCount');
    if (badge) badge.textContent = activeCount;
  }

  // Initialize sales trend chart
  let salesChart;
  function initSalesTrendChart() {
    const canvas = document.getElementById('salesTrendChart');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const chartLabels = JSON.parse(document.getElementById('chart-data-holder').getAttribute('data-labels') || '[]');
    const revenueData = JSON.parse(document.getElementById('chart-data-holder').getAttribute('data-revenue') || '[]');
    const orderData = JSON.parse(document.getElementById('chart-data-holder').getAttribute('data-orders') || '[]');

    salesChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: chartLabels,
        datasets: [{
          label: 'Revenue',
          data: revenueData,
          borderColor: '#4f46e5',
          backgroundColor: 'rgba(79, 70, 229, 0.1)',
          borderWidth: 2,
          fill: true,
          tension: 0.4,
          pointBackgroundColor: '#ffffff',
          pointBorderColor: '#4f46e5',
          pointBorderWidth: 2,
          pointRadius: 4,
          pointHoverRadius: 6,
          yAxisID: 'y'
        }, {
          label: 'Orders',
          data: orderData,
          borderColor: '#10b981',
          backgroundColor: 'rgba(16, 185, 129, 0.1)',
          borderWidth: 2,
          fill: false,
          tension: 0.4,
          pointBackgroundColor: '#ffffff',
          pointBorderColor: '#10b981',
          pointBorderWidth: 2,
          pointRadius: 4,
          pointHoverRadius: 6,
          yAxisID: 'y1',
          hidden: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            mode: 'index',
            intersect: false,
            backgroundColor: 'rgba(255, 255, 255, 0.9)',
            titleColor: '#1f2937',
            bodyColor: '#4b5563',
            borderColor: '#e5e7eb',
            borderWidth: 1,
            padding: 12,
            boxPadding: 4,
            usePointStyle: true,
            callbacks: {
              label: function(context) {
                if (context.datasetIndex === 0) {
                  return `Revenue: ₹${context.parsed.y.toLocaleString('en-IN')}`;
                } else {
                  return `Orders: ${context.parsed.y}`;
                }
              }
            }
          }
        },
        scales: {
          x: {
            grid: {
              display: false
            },
            ticks: {
              color: '#6b7280'
            }
          },
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            beginAtZero: true,
            grid: {
              color: '#f3f4f6'
            },
            ticks: {
              color: '#6b7280',
              callback: function(value) {
                return '₹' + value.toLocaleString('en-IN');
              }
            }
          },
          y1: {
            type: 'linear',
            display: false,
            position: 'right',
            beginAtZero: true,
            grid: {
              drawOnChartArea: false,
            },
            ticks: {
              color: '#6b7280'
            }
          }
        },
        interaction: {
          intersect: false,
          mode: 'index'
        }
      }
    });

    // Handle metric selector
    const trendMetric = document.getElementById('trendMetric');
    if (trendMetric) {
      trendMetric.addEventListener('change', function(e) {
        const metric = e.target.value;
        if (metric === 'revenue') {
          salesChart.data.datasets[0].hidden = false;
          salesChart.data.datasets[1].hidden = true;
          salesChart.options.scales.y.display = true;
          salesChart.options.scales.y1.display = false;
        } else if (metric === 'orders') {
          salesChart.data.datasets[0].hidden = true;
          salesChart.data.datasets[1].hidden = false;
          salesChart.options.scales.y.display = false;
          salesChart.options.scales.y1.display = true;
        }
        salesChart.update();
      });
    }
  }

  // Initialize page
  document.addEventListener('DOMContentLoaded', function() {
  initSalesTrendChart();
  updateActiveFiltersCount();

    // Handle filter form reset
  const filtersFormEl = document.getElementById('filtersForm');
  if (filtersFormEl) filtersFormEl.addEventListener('reset', function(e) {
      setTimeout(updateActiveFiltersCount, 0);
    });

  // Handle form changes
  if (filtersFormEl) filtersFormEl.addEventListener('change', updateActiveFiltersCount);

    // Close export menu when clicking outside
    document.addEventListener('click', function(e) {
      const exportMenu = document.getElementById('exportMenu');
      const exportBtn = e.target.closest('button');
      if (!exportBtn && !exportMenu.contains(e.target)) {
        exportMenu.classList.add('hidden');
      }
    });
  });
</script>
<style nonce="<%= (typeof cspNonce !== 'undefined' ? cspNonce : '') %>">
  :root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --secondary: #10b981;
    --accent: #8b5cf6;
    --light: #f8fafc;
    --dark: #0f172a;
    --success: #22c55e;
    --warning: #f59e0b;
    --danger: #ef4444;
    --info: #3b82f6;
    --card-bg: rgba(255, 255, 255, 0.7);
    --card-border: rgba(99, 102, 241, 0.15);
  }
  
  * {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  }
  
  body {
    background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
    min-height: 100vh;
    margin: 0;
    color: var(--dark);
    overflow-x: hidden;
  }
  
  .dashboard-container {
    max-width: 1800px;
    margin: 0 auto;
    padding: 1.5rem;
  }
  
  /* Header Styles */
  .dashboard-header {
    background: var(--card-bg);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-radius: 1.5rem;
    padding: 1.5rem 2rem;
    box-shadow: 0 10px 25px -10px rgba(99, 102, 241, 0.1);
    border: 1px solid var(--card-border);
    margin-bottom: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  
  @media (min-width: 1024px) {
    .dashboard-header {
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
    }
  }
  
  .header-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  
  .header-title h1 {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--primary-dark);
    margin: 0;
    background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  
  .header-meta {
    display: flex;
    gap: 1.5rem;
    color: #64748b;
    font-size: 0.9rem;
  }
  
  .header-meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .export-btn {
    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    color: white;
    padding: 0.8rem 1.5rem;
    border-radius: 0.75rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2);
    text-decoration: none;
    border: none;
    cursor: pointer;
  }
  
  .export-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(99, 102, 241, 0.3);
  }
  
  /* Filters Section */
  .filters-section {
    background: var(--card-bg);
    backdrop-filter: blur(16px);
    border-radius: 1.5rem;
    padding: 1.5rem;
    box-shadow: 0 10px 25px -10px rgba(99, 102, 241, 0.1);
    border: 1px solid var(--card-border);
    margin-bottom: 2rem;
  }
  
  .filters-grid {
    display: grid;
    grid-template-columns: repeat(1, minmax(0, 1fr));
    gap: 1.25rem;
  }
  
  @media (min-width: 768px) {
    .filters-grid {
      grid-template-columns: repeat(4, minmax(0, 1fr));
    }
  }
  
  .filter-group label {
    display: block;
    font-weight: 500;
    margin-bottom: 0.5rem;
    color: var(--primary-dark);
  }
  
  .filter-control {
    width: 100%;
    padding: 0.8rem 1rem;
    border-radius: 0.75rem;
    border: 1px solid #e2e8f0;
    background: white;
    transition: all 0.3s ease;
    font-size: 0.95rem;
  }
  
  .filter-control:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
  }
  
  .refresh-btn {
    background: linear-gradient(135deg, var(--primary) 0%, var(--info) 100%);
    color: white;
    padding: 0.8rem;
    border-radius: 0.75rem;
    font-weight: 600;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2);
    width: 100%;
    height: 100%;
  }
  
  .refresh-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(99, 102, 241, 0.3);
  }
  
  /* Metrics Section */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(1, minmax(0, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }
  
  @media (min-width: 640px) {
    .metrics-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }
  
  @media (min-width: 1024px) {
    .metrics-grid {
      grid-template-columns: repeat(4, minmax(0, 1fr));
    }
  }
  
  .metric-card {
    background: var(--card-bg);
    backdrop-filter: blur(16px);
    border-radius: 1.25rem;
    padding: 1.5rem;
    box-shadow: 0 10px 25px -10px rgba(99, 102, 241, 0.1);
    border: 1px solid var(--card-border);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
    position: relative;
    overflow: hidden;
  }
  
  .metric-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 25px -10px rgba(99, 102, 241, 0.25);
  }
  
  .metric-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
  }
  
  .metric-title {
    font-size: 1rem;
    font-weight: 600;
    color: #64748b;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .metric-value {
    font-size: 2rem;
    font-weight: 700;
    margin: 0.5rem 0;
  }
  
  .metric-icon {
    position: absolute;
    bottom: 1rem;
    right: 1.5rem;
    font-size: 2.5rem;
    opacity: 0.15;
    z-index: 0;
  }
  
  .metric-card:nth-child(1) .metric-value { color: var(--primary); }
  .metric-card:nth-child(2) .metric-value { color: var(--success); }
  .metric-card:nth-child(3) .metric-value { color: var(--info); }
  .metric-card:nth-child(4) .metric-value { color: var(--danger); }
  
  /* Data Tables Section */
  .data-section {
    margin-bottom: 2.5rem;
  }
  
  .section-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
  }
  
  .section-header h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-dark);
    margin: 0;
  }
  
  .section-header i {
    color: var(--primary);
    font-size: 1.5rem;
  }
  
  .data-table-container {
    background: var(--card-bg);
    backdrop-filter: blur(16px);
    border-radius: 1.25rem;
    overflow-x: auto;
    box-shadow: 0 10px 25px -10px rgba(99, 102, 241, 0.1);
    border: 1px solid var(--card-border);
  }
  
  .data-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }
  
  .data-table thead {
    background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
    color: white;
  }
  
  .data-table thead th {
    padding: 1rem 1.5rem;
    text-align: left;
    font-weight: 600;
    font-size: 0.9rem;
  }
  
  .data-table tbody tr {
    transition: background-color 0.2s ease;
  }
  
  .data-table tbody tr:nth-child(even) {
    background-color: rgba(241, 245, 249, 0.5);
  }
  
  .data-table tbody tr:hover {
    background-color: rgba(224, 231, 255, 0.5);
  }
  
  .data-table tbody td {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #f1f5f9;
    font-size: 0.95rem;
  }
  
  .no-data-row td {
    text-align: center;
    padding: 2rem;
    color: #64748b;
    font-style: italic;
  }
  
  /* Footer */
  .dashboard-footer {
    text-align: center;
    padding: 1.5rem;
    color: #64748b;
    font-size: 0.9rem;
    margin-top: auto;
    border-top: 1px solid #e2e8f0;
  }

  /* Surprise: Animated gradient border and floating effect for metrics cards */
  .metric-card-animated {
    box-shadow: 0 8px 32px 0 rgba(99,102,241,0.18), 0 1.5px 8px 0 rgba(139,92,246,0.10);
    border-radius: 1.5rem;
    position: relative;
    z-index: 1;
    background-clip: padding-box;
  }
  .metric-card-animated::before {
    content: "";
    position: absolute;
    inset: -4px;
    z-index: -1;
    border-radius: 1.7rem;
    background: linear-gradient(270deg, #6366f1, #10b981, #8b5cf6, #ef4444, #3b82f6, #6366f1);
    background-size: 1200% 1200%;
    animation: borderGradientMove 6s ease infinite;
    filter: blur(2px);
    opacity: 0.7;
  }
  @keyframes borderGradientMove {
    0% {background-position:0% 50%}
    50% {background-position:100% 50%}
    100% {background-position:0% 50%}
  }
  .metric-card-animated:hover {
    box-shadow: 0 16px 48px 0 rgba(99,102,241,0.22), 0 3px 16px 0 rgba(139,92,246,0.16);
    transform: translateY(-8px) scale(1.07);
    transition: box-shadow 0.3s, transform 0.3s;
  }
  
  /* Animations */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .animate-fade-in {
    animation: fadeIn 0.6s ease forwards;
  }
  
  .delay-100 { animation-delay: 0.1s; }
  .delay-200 { animation-delay: 0.2s; }
  .delay-300 { animation-delay: 0.3s; }
  .delay-400 { animation-delay: 0.4s; }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .dashboard-container {
      padding: 1rem;
    }
    
    .dashboard-header {
      padding: 1rem;
    }
    
    .header-title h1 {
      font-size: 1.5rem;
    }
    
    .header-meta {
      flex-wrap: wrap;
      gap: 0.75rem;
    }
    
    .filters-section {
      padding: 1rem;
    }
    
    .metric-card {
      padding: 1.25rem;
    }
    
    .metric-value {
      font-size: 1.75rem;
    }
  }
</style>


