<%- include('../partials/header.ejs', { title: 'Dashboard' }) %>

<!-- Flash Messages -->
<% if (success && success.length) { %>
  <div class="mb-6 p-4 rounded-lg border-l-4 border-green-400 bg-green-50 text-green-800 shadow-sm">
    <% success.forEach(msg => { %>
      <div class="flex items-center gap-2">
        <i class="fa fa-check-circle"></i>
        <%= msg %>
      </div>
    <% }) %>
  </div>
<% } %>

<% if (error && error.length) { %>
  <div class="mb-6 p-4 rounded-lg border-l-4 border-red-400 bg-red-50 text-red-800 shadow-sm">
    <% error.forEach(msg => { %>
      <div class="flex items-center gap-2">
        <i class="fa fa-exclamation-circle"></i>
        <%= msg %>
      </div>
    <% }) %>
  </div>
<% } %>

<!-- Welcome Section -->
<div class="mb-8">
  <div class="bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 rounded-2xl p-8 text-white shadow-xl">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
      <div class="mb-6 lg:mb-0">
        <h1 class="text-3xl lg:text-4xl font-bold mb-3">
          Good <%= new Date().getHours() < 12 ? 'Morning' : new Date().getHours() < 18 ? 'Afternoon' : 'Evening' %>, <%= fullname || username || 'Administrator' %>
        </h1>
        <p class="text-lg opacity-90 flex items-center gap-2">
          <i class="fas fa-calendar-alt"></i>
          <%= day %>, <%= today %>
        </p>
      </div>
      
      <div class="flex items-center gap-3">
        <div class="bg-white/10 backdrop-blur-sm px-4 py-3 rounded-xl border border-white/20">
          <span class="font-semibold capitalize flex items-center gap-2">
            <i class="fas fa-shield-alt text-blue-300"></i>
            <%= role === 'superadmin' ? 'Administrator' : role === 'developer' ? 'Developer' : role %>
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Key Metrics -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
  <!-- Active Users -->
  <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-all duration-300">
    <div class="flex items-center justify-between mb-4">
      <div class="p-3 bg-emerald-50 rounded-lg">
        <i class="fas fa-users text-xl text-emerald-600"></i>
      </div>
      <div class="text-right">
        <p class="text-sm text-gray-600 font-medium">Active Users</p>
        <h3 class="text-2xl font-bold text-gray-900"><%= stats.totalUsers.toLocaleString() %></h3>
      </div>
    </div>
    <div class="text-sm text-gray-500">
      Registered customers
    </div>
  </div>

  <!-- Today's Orders -->
  <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-all duration-300">
    <div class="flex items-center justify-between mb-4">
      <div class="p-3 bg-blue-50 rounded-lg">
        <i class="fas fa-shopping-cart text-xl text-blue-600"></i>
      </div>
      <div class="text-right">
        <p class="text-sm text-gray-600 font-medium">Today's Orders</p>
        <h3 class="text-2xl font-bold text-gray-900"><%= stats.todayOrders %></h3>
      </div>
    </div>
    <div class="text-sm text-gray-500">
      Orders processed today
    </div>
  </div>

  <!-- Total Products -->
  <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-all duration-300">
    <div class="flex items-center justify-between mb-4">
      <div class="p-3 bg-amber-50 rounded-lg">
        <i class="fas fa-boxes text-xl text-amber-600"></i>
      </div>
      <div class="text-right">
        <p class="text-sm text-gray-600 font-medium">Total Products</p>
        <h3 class="text-2xl font-bold text-gray-900"><%= stats.totalProducts || 0 %></h3>
      </div>
    </div>
    <div class="text-sm text-gray-500">
      Items in inventory
    </div>
  </div>

  <!-- System Admins -->
  <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-all duration-300">
    <div class="flex items-center justify-between mb-4">
      <div class="p-3 bg-slate-50 rounded-lg">
        <i class="fas fa-user-shield text-xl text-slate-600"></i>
      </div>
      <div class="text-right">
        <p class="text-sm text-gray-600 font-medium">Administrators</p>
        <h3 class="text-2xl font-bold text-gray-900"><%= stats.totalAdmins %></h3>
      </div>
    </div>
    <div class="text-sm text-gray-500">
      System administrators
    </div>
  </div>
</div>

<!-- Main Actions Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
  <!-- Quick Actions -->
  <div class="lg:col-span-2">
    <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2">
      <i class="fas fa-tachometer-alt text-slate-600"></i>
      Management Center
    </h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Order Management -->
      <a href="/admin/v1/order" class="group bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md hover:border-blue-200 transition-all duration-300">
        <div class="flex items-center gap-4 mb-4">
          <div class="p-3 bg-blue-50 rounded-lg group-hover:bg-blue-100 transition-colors">
            <i class="fas fa-shopping-cart text-xl text-blue-600"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-900 group-hover:text-blue-600 transition-colors">Order Management</h3>
            <p class="text-gray-600 text-sm">Process and track customer orders</p>
          </div>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-sm text-gray-500">Manage orders</span>
          <i class="fas fa-arrow-right text-blue-600 group-hover:translate-x-1 transition-transform"></i>
        </div>
      </a>

      <!-- Product Management -->
      <a href="/admin/v1/products" class="group bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md hover:border-emerald-200 transition-all duration-300">
        <div class="flex items-center gap-4 mb-4">
          <div class="p-3 bg-emerald-50 rounded-lg group-hover:bg-emerald-100 transition-colors">
            <i class="fas fa-boxes text-xl text-emerald-600"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-900 group-hover:text-emerald-600 transition-colors">Product Catalog</h3>
            <p class="text-gray-600 text-sm">Manage inventory and products</p>
          </div>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-sm text-gray-500">Manage products</span>
          <i class="fas fa-arrow-right text-emerald-600 group-hover:translate-x-1 transition-transform"></i>
        </div>
      </a>

      <!-- Customer Management -->
      <a href="/admin/v1/customers" class="group bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md hover:border-purple-200 transition-all duration-300">
        <div class="flex items-center gap-4 mb-4">
          <div class="p-3 bg-purple-50 rounded-lg group-hover:bg-purple-100 transition-colors">
            <i class="fas fa-users text-xl text-purple-600"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-900 group-hover:text-purple-600 transition-colors">Customer Management</h3>
            <p class="text-gray-600 text-sm">Manage customer accounts</p>
          </div>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-sm text-gray-500">Manage customers</span>
          <i class="fas fa-arrow-right text-purple-600 group-hover:translate-x-1 transition-transform"></i>
        </div>
      </a>

      <!-- Inventory Management -->
      <a href="/admin/inventory" class="group bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md hover:border-orange-200 transition-all duration-300">
        <div class="flex items-center gap-4 mb-4">
          <div class="p-3 bg-orange-50 rounded-lg group-hover:bg-orange-100 transition-colors">
            <i class="fas fa-warehouse text-xl text-orange-600"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-900 group-hover:text-orange-600 transition-colors">Inventory Management</h3>
            <p class="text-gray-600 text-sm">Stock levels and movements</p>
          </div>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-sm text-gray-500">Manage inventory</span>
          <i class="fas fa-arrow-right text-orange-600 group-hover:translate-x-1 transition-transform"></i>
        </div>
      </a>

      <!-- Analytics -->
      <a href="/admin/reports/comprehensive" class="group bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md hover:border-indigo-200 transition-all duration-300">
        <div class="flex items-center gap-4 mb-4">
          <div class="p-3 bg-indigo-50 rounded-lg group-hover:bg-indigo-100 transition-colors">
            <i class="fas fa-chart-line text-xl text-indigo-600"></i>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-900 group-hover:text-indigo-600 transition-colors">Analytics & Reports</h3>
            <p class="text-gray-600 text-sm">Sales insights and reporting</p>
          </div>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-sm text-gray-500">View analytics</span>
          <i class="fas fa-arrow-right text-indigo-600 group-hover:translate-x-1 transition-transform"></i>
        </div>
      </a>
    </div>
  </div>

  <!-- Quick Add Actions -->
  <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
    <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2">
      <i class="fas fa-plus-circle text-emerald-500"></i>
      Quick Add
    </h3>
    <div class="space-y-4">
      <a href="/admin/v1/products/new" class="flex items-center gap-4 p-4 rounded-lg bg-gray-50 hover:bg-emerald-50 transition-colors group">
        <div class="p-3 bg-emerald-100 rounded-lg group-hover:bg-emerald-200 transition-colors">
          <i class="fas fa-box text-emerald-600"></i>
        </div>
        <div>
          <span class="font-semibold text-gray-800 group-hover:text-emerald-700 block">New Product</span>
          <span class="text-sm text-gray-500">Add to inventory</span>
        </div>
      </a>
      <a href="/admin/v1/staff/register" class="flex items-center gap-4 p-4 rounded-lg bg-gray-50 hover:bg-blue-50 transition-colors group">
        <div class="p-3 bg-blue-100 rounded-lg group-hover:bg-blue-200 transition-colors">
          <i class="fas fa-user-plus text-blue-600"></i>
        </div>
        <div>
          <span class="font-semibold text-gray-800 group-hover:text-blue-700 block">New Admin</span>
          <span class="text-sm text-gray-500">Add administrator</span>
        </div>
      </a>
      <a href="/admin/v1/parameters/categories/new" class="flex items-center gap-4 p-4 rounded-lg bg-gray-50 hover:bg-purple-50 transition-colors group">
        <div class="p-3 bg-purple-100 rounded-lg group-hover:bg-purple-200 transition-colors">
          <i class="fas fa-tags text-purple-600"></i>
        </div>
        <div>
          <span class="font-semibold text-gray-800 group-hover:text-purple-700 block">New Category</span>
          <span class="text-sm text-gray-500">Add product category</span>
        </div>
      </a>
    </div>
    
    <!-- Account Settings Corner -->
    <div class="mt-6 pt-4 border-t border-gray-200">
      <a href="/admin/v1/staff/change-password" class="flex items-center gap-3 p-3 rounded-lg bg-slate-50 hover:bg-slate-100 transition-colors group">
        <div class="p-2 bg-slate-100 rounded-lg group-hover:bg-slate-200 transition-colors">
          <i class="fas fa-cog text-slate-600 text-sm"></i>
        </div>
        <div>
          <span class="font-medium text-gray-800 text-sm block">Account Settings</span>
          <span class="text-xs text-gray-500">Manage security</span>
        </div>
      </a>
    </div>
  </div>
</div>



<!-- Inventory Alerts -->
<div class="mb-8">
  <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <div class="p-3 bg-amber-50 rounded-lg">
          <i class="fas fa-warehouse text-amber-600 text-xl"></i>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-gray-900">Inventory Status</h3>
          <p class="text-sm text-gray-600">Real-time stock monitoring</p>
        </div>
      </div>
      <a href="/admin/inventory" class="text-sm text-slate-600 hover:text-slate-800 font-medium">
        View Dashboard â†’
      </a>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Critical Stock Alert -->
      <div class="bg-red-50 border border-red-200 rounded-lg p-4">
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-2">
            <i class="fas fa-exclamation-triangle text-red-500"></i>
            <span class="text-red-700 font-medium text-sm">Out of Stock</span>
          </div>
          <span class="bg-red-100 text-red-800 text-xs font-medium px-2 py-1 rounded-full" id="critical-stock-count">-</span>
        </div>
        <p class="text-xs text-red-600">Items completely out of stock</p>
      </div>
      
      <!-- Low Stock Alert -->
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-2">
            <i class="fas fa-exclamation-circle text-yellow-500"></i>
            <span class="text-yellow-700 font-medium text-sm">Low Stock</span>
          </div>
          <span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2 py-1 rounded-full" id="low-stock-count">-</span>
        </div>
        <p class="text-xs text-yellow-600">Items below threshold</p>
      </div>
      
      <!-- Recent Movements -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-2">
            <i class="fas fa-exchange-alt text-blue-500"></i>
            <span class="text-blue-700 font-medium text-sm">Recent Activity</span>
          </div>
          <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full" id="recent-movements-count">-</span>
        </div>
        <p class="text-xs text-blue-600">Stock movements today</p>
      </div>
    </div>
  </div>
</div>

<script>
// Use server-side inventory data
<% if (typeof inventory !== 'undefined') { %>
  document.getElementById('critical-stock-count').textContent = '<%= inventory.criticalStockCount %>';
  document.getElementById('low-stock-count').textContent = '<%= inventory.lowStockCount %>';
  
  // Calculate today's movements
  const today = new Date().toDateString();
  const todayMovements = <%= JSON.stringify(inventory.recentMovements) %>
    .filter(m => new Date(m.createdAt).toDateString() === today);
  document.getElementById('recent-movements-count').textContent = todayMovements.length;
<% } else { %>
  // Fallback to API if inventory data not available
  fetch('/admin/inventory/api/low-stock')
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        const alerts = data.data;
        const criticalCount = alerts.filter(a => a.status === 'out_of_stock').length;
        const lowStockCount = alerts.filter(a => a.status === 'low_stock').length;
        
        document.getElementById('critical-stock-count').textContent = criticalCount;
        document.getElementById('low-stock-count').textContent = lowStockCount;
      }
    })
    .catch(err => console.log('Inventory data load failed'));

  fetch('/admin/inventory/api/movements?limit=10')
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        const today = new Date().toDateString();
        const todayMovements = data.data.filter(m => new Date(m.createdAt).toDateString() === today);
        document.getElementById('recent-movements-count').textContent = todayMovements.length;
      }
    })
    .catch(err => console.log('Movement data load failed'));
<% } %>
</script>

<!-- System Overview -->
<div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
  <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2">
    <i class="fas fa-server text-slate-600"></i>
    System Overview
  </h2>
  
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <div class="text-center p-4 bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg border border-slate-200">
      <div class="flex items-center justify-center mb-2">
        <i class="fas fa-tags text-slate-600 text-lg"></i>
      </div>
      <p class="text-slate-600 text-sm font-medium">Categories</p>
      <h4 class="text-xl font-bold text-slate-800"><%= stats.totalCategories || 0 %></h4>
    </div>
    
    <div class="text-center p-4 bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg border border-slate-200">
      <div class="flex items-center justify-center mb-2">
        <i class="fas fa-sitemap text-slate-600 text-lg"></i>
      </div>
      <p class="text-slate-600 text-sm font-medium">Subcategories</p>
      <h4 class="text-xl font-bold text-slate-800"><%= stats.totalSubCategories || 0 %></h4>
    </div>
    
    <div class="text-center p-4 bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg border border-slate-200">
      <div class="flex items-center justify-center mb-2">
        <i class="fas fa-layer-group text-slate-600 text-lg"></i>
      </div>
      <p class="text-slate-600 text-sm font-medium">Types</p>
      <h4 class="text-xl font-bold text-slate-800"><%= stats.totalTypes || 0 %></h4>
    </div>
    
    <div class="text-center p-4 bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg border border-slate-200">
      <div class="flex items-center justify-center mb-2">
        <i class="fas fa-award text-slate-600 text-lg"></i>
      </div>
      <p class="text-slate-600 text-sm font-medium">Brands</p>
      <h4 class="text-xl font-bold text-slate-800"><%= stats.totalBrands || 0 %></h4>
    </div>
  </div>
</div>

<%- include('../partials/footer.ejs') %>