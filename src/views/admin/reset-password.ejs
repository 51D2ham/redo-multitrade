<%- include('../partials/auth-header.ejs', { title: 'Reset Password' }) %>

      <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-700 p-8 text-center">
      <div class="flex justify-center mb-4">
        <div class="w-16 h-16 rounded-2xl bg-white flex items-center justify-center shadow-lg">
          <i class="fa fa-key text-blue-600 text-3xl"></i>
        </div>
      </div>
      <h1 class="text-2xl font-bold text-white mb-1">Reset Password</h1>
      <p class="text-blue-100">Create a new secure password for your account</p>
    </div>
    
    <div class="p-8">
      <!-- Flash Messages -->
      <% if (error && error.length) { %>
        <div class="mb-6 p-4 rounded-lg border-l-4 border-red-400 bg-red-50 text-red-800">
          <% error.forEach(msg => { %>
            <div class="flex items-center gap-2">
              <i class="fa fa-exclamation-circle"></i>
              <%= msg %>
            </div>
          <% }) %>
        </div>
      <% } %>
      <% if (success && success.length) { %>
        <div class="mb-6 p-4 rounded-lg border-l-4 border-green-400 bg-green-50 text-green-800">
          <% success.forEach(msg => { %>
            <div class="flex items-center gap-2">
              <i class="fa fa-check-circle"></i>
              <%= msg %>
            </div>
          <% }) %>
        </div>
      <% } %>

      <!-- Reset Form -->
      <form action="/admin/v1/staff/reset-password" method="POST" class="space-y-6">
        <!-- Email Field -->
        <div>
          <label for="email" class="block font-semibold mb-2 text-gray-700">Email Address</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fa fa-envelope text-gray-400"></i>
            </div>
            <input
              id="email"
              name="email"
              type="email"
              placeholder="admin@example.com"
              value="<%= typeof email !== 'undefined' ? email : '' %>"
              class="w-full p-3 pl-10 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition"
              required
              autocomplete="username"
            >
          </div>
        </div>

        <!-- OTP Field -->
        <div>
          <label for="otpCode" class="block font-semibold mb-2 text-gray-700">Verification Code</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fa fa-shield-alt text-gray-400"></i>
            </div>
            <input
              id="otpCode"
              name="otpCode"
              type="text"
              inputmode="numeric"
              pattern="[0-9]*"
              maxlength="6"
              placeholder="Enter 6-digit code"
              class="w-full p-3 pl-10 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition"
              required
              autocomplete="one-time-code"
            >
          </div>
          <p class="mt-1 text-sm text-gray-500">Check your email for the 6-digit verification code</p>
        </div>

        <!-- New Password Field -->
        <div>
          <label for="newPassword" class="block font-semibold mb-2 text-gray-700">New Password</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fa fa-lock text-gray-400"></i>
            </div>
            <input
              id="newPassword"
              name="newPassword"
              type="password"
              placeholder="Create a strong password"
              class="w-full p-3 pl-10 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition"
              required
              autocomplete="new-password"
              minlength="8"
            >
          </div>
          <ul class="mt-2 space-y-1 text-sm text-gray-500">
            <li class="flex items-center">
              <i class="fa fa-circle text-[6px] mr-2 text-gray-300"></i>
              Minimum 8 characters
            </li>
            <li class="flex items-center">
              <i class="fa fa-circle text-[6px] mr-2 text-gray-300"></i>
              At least one uppercase letter
            </li>
            <li class="flex items-center">
              <i class="fa fa-circle text-[6px] mr-2 text-gray-300"></i>
              At least one number
            </li>
          </ul>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="w-full px-4 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition flex items-center justify-center">
          <i class="fa fa-key mr-2"></i> Reset Password
        </button>


        <!-- Back Link -->
        <div class="mt-6 text-center">
          <a href="/admin/v1/staff/login" class="text-gray-500 hover:text-gray-700 font-medium transition flex items-center justify-center">
            <i class="fa fa-arrow-left mr-2"></i> Back to Login
          </a>
        </div>
      </form>
    </div>
    
    <!-- Security Notice -->
    <div class="bg-gray-50 px-8 py-4 border-t border-gray-100 text-center">
      <p class="text-gray-500 text-sm flex items-center justify-center gap-1.5">
        <i class="fa fa-shield-alt text-green-500"></i>
        Your password is encrypted and never stored in plain text
      </p>
    </div>
  </div>

<script nonce="<%= (typeof cspNonce !== 'undefined' ? cspNonce : '') %>">
  document.addEventListener('DOMContentLoaded', function() {
    const resendOTPBtn = document.getElementById('resendOTP');
    
    if (resendOTPBtn) {
      let isCooldown = false;
      let cooldownTime = 60;
      
      resendOTPBtn.addEventListener('click', function() {
        if (isCooldown) return;
        
        const email = document.getElementById('email').value;
        if (!email) {
          alert('Please enter your email address first');
          return;
        }
        
        // Show cooldown state
        isCooldown = true;
        resendOTPBtn.innerHTML = `<i class="fa fa-spinner fa-spin mr-2"></i> Sending...`;
        
        // Simulate API call
        setTimeout(() => {
          // In a real app, you'd make an AJAX call here
          console.log('Resending OTP to:', email);
          
          // Update button state
          resendOTPBtn.innerHTML = `<i class="fa fa-check-circle mr-2 text-green-500"></i> Code Sent!`;
          
          // Start cooldown
          const originalText = 'Resend Verification Code';
          let timeLeft = 60;
          
          const countdown = setInterval(() => {
            timeLeft--;
            if (timeLeft <= 0) {
              clearInterval(countdown);
              isCooldown = false;
              resendOTPBtn.innerHTML = `<i class="fa fa-redo mr-2"></i> ${originalText}`;
            } else {
              resendOTPBtn.innerHTML = `<i class="fa fa-clock mr-2"></i> Resend in ${timeLeft}s`;
            }
          }, 1000);
        }, 1000);
      });
    }
  });
</script>

<%- include('../partials/auth-footer.ejs') %>