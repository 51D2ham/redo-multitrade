<%- include('../partials/header.ejs', { title: 'Bulk Upload Products' }) %>

<!-- Navigation Breadcrumb -->
<nav class="flex items-center gap-2 mb-8 p-4 bg-white rounded-xl shadow-sm border border-gray-100">
  <a href="/admin/v1/staff/dashboard" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-50 text-blue-700 hover:bg-blue-100 transition">
    <i class="fa fa-home"></i> Dashboard
  </a>
  <i class="fa fa-chevron-right text-gray-400 text-sm"></i>
  <a href="/admin/v1/products" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-50 text-gray-700 hover:bg-gray-100 transition">
    <i class="fa fa-box"></i> Products
  </a>
  <i class="fa fa-chevron-right text-gray-400 text-sm"></i>
  <span class="px-4 py-2 text-gray-600 font-medium">Bulk Upload</span>
</nav>

<main class="container mx-auto px-4">
  <!-- Header Section -->
  <div class="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-2xl p-8 mb-8 text-white">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold mb-2">CSV Bulk Upload</h1>
        <p class="text-purple-100">Upload multiple products at once using CSV files</p>
      </div>
      <div class="w-20 h-20 bg-white/20 rounded-2xl flex items-center justify-center">
        <i class="fa fa-upload text-3xl"></i>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Upload Section -->
    <div class="lg:col-span-2">
      <div class="bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden">
        <!-- Flash Messages -->
        <% if (error && error.length) { %>
          <div class="p-4 bg-red-50 border-b border-red-200">
            <% error.forEach(msg => { %>
              <div class="flex items-center gap-2 text-red-700">
                <i class="fa fa-exclamation-circle"></i>
                <%= msg %>
              </div>
            <% }) %>
          </div>
        <% } %>
        <% if (success && success.length) { %>
          <div class="p-4 bg-green-50 border-b border-green-200">
            <% success.forEach(msg => { %>
              <div class="flex items-center gap-2 text-green-700">
                <i class="fa fa-check-circle"></i>
                <%= msg %>
              </div>
            <% }) %>
          </div>
        <% } %>

        <div class="p-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
              <i class="fa fa-file-csv text-purple-600"></i>
            </div>
            Upload CSV File
          </h2>

          <form action="/admin/v1/products/bulk-upload" method="POST" enctype="multipart/form-data" class="space-y-6">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <input type="hidden" name="_token" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
            
            <!-- File Upload Area -->
            <div class="bg-gray-50 rounded-xl p-6">
              <label for="fileInput" class="block text-sm font-medium text-gray-700 mb-3">Select CSV File</label>
              <input type="file" name="csvFile" accept=".csv" required id="fileInput" class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-purple-600 file:text-white file:hover:bg-purple-700">
              <p class="text-sm text-gray-500 mt-2">Maximum file size: 10MB • Supported format: CSV</p>
            </div>

            <!-- File Info -->
            <div id="fileInfo" class="hidden bg-gray-50 rounded-lg p-4">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                    <i class="fa fa-file-csv text-green-600"></i>
                  </div>
                  <div>
                    <div class="font-medium text-gray-800" id="fileName"></div>
                    <div class="text-sm text-gray-500" id="fileSize"></div>
                  </div>
                </div>
                <button type="button" onclick="clearFile()" class="text-red-500 hover:text-red-700">
                  <i class="fa fa-times"></i>
                </button>
              </div>
            </div>

            <!-- Upload Options -->
            <div class="bg-gray-50 rounded-lg p-6">
              <h3 class="font-semibold text-gray-800 mb-4">Upload Options</h3>
              <div class="space-y-3">
                <label class="flex items-center gap-3">
                  <input type="checkbox" name="skipDuplicates" checked class="w-4 h-4 text-purple-600 rounded">
                  <span class="text-gray-700">Skip duplicate products (based on SKU)</span>
                </label>
                <label class="flex items-center gap-3">
                  <input type="checkbox" name="validateData" checked class="w-4 h-4 text-purple-600 rounded">
                  <span class="text-gray-700">Validate data before import</span>
                </label>
                <label class="flex items-center gap-3">
                  <input type="checkbox" name="sendNotification" class="w-4 h-4 text-purple-600 rounded">
                  <span class="text-gray-700">Send email notification when complete</span>
                </label>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-end gap-4">
              <a href="/admin/v1/products" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition font-medium">
                Cancel
              </a>
              <button type="submit" class="px-8 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-medium flex items-center gap-2">
                <i class="fa fa-upload"></i>
                Upload Products
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Template Download -->
      <div class="bg-white rounded-xl shadow-md border border-gray-100 p-6">
        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
          <i class="fa fa-download text-blue-600"></i>
          CSV Template
        </h3>
        <p class="text-gray-600 mb-4 text-sm">Download the template to ensure your CSV file has the correct format.</p>
        <a href="/sample_data/product_upload_template.csv" download class="w-full bg-blue-600 text-white text-center py-3 rounded-lg hover:bg-blue-700 transition font-medium flex items-center justify-center gap-2">
          <i class="fa fa-download"></i>
          Download Template
        </a>
      </div>

      <!-- Sample Data -->
      <div class="bg-white rounded-xl shadow-md border border-gray-100 p-6">
        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
          <i class="fa fa-database text-green-600"></i>
          Sample Data
        </h3>
        <p class="text-gray-600 mb-4 text-sm">Download sample data to see how products should be formatted.</p>
        <a href="/sample_data/product_sample_data.csv" download class="w-full bg-green-600 text-white text-center py-3 rounded-lg hover:bg-green-700 transition font-medium flex items-center justify-center gap-2">
          <i class="fa fa-download"></i>
          Download Sample
        </a>
      </div>

      <!-- Upload Guidelines -->
      <div class="bg-white rounded-xl shadow-md border border-gray-100 p-6">
        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
          <i class="fa fa-info-circle text-amber-600"></i>
          Guidelines
        </h3>
        <div class="space-y-3 text-sm text-gray-600">
          <div class="flex items-start gap-2">
            <i class="fa fa-check text-green-500 mt-0.5"></i>
            <span>Use the provided CSV template</span>
          </div>
          <div class="flex items-start gap-2">
            <i class="fa fa-check text-green-500 mt-0.5"></i>
            <span>Maximum 1000 products per upload</span>
          </div>
          <div class="flex items-start gap-2">
            <i class="fa fa-check text-green-500 mt-0.5"></i>
            <span>Ensure all required fields are filled</span>
          </div>
          <div class="flex items-start gap-2">
            <i class="fa fa-check text-green-500 mt-0.5"></i>
            <span>Use valid category and brand IDs</span>
          </div>
          <div class="flex items-start gap-2">
            <i class="fa fa-exclamation-triangle text-amber-500 mt-0.5"></i>
            <span>Images must be uploaded separately</span>
          </div>
        </div>
      </div>

      <!-- Recent Uploads -->
      <div class="bg-white rounded-xl shadow-md border border-gray-100 p-6">
        <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
          <i class="fa fa-history text-gray-600"></i>
          Recent Uploads
        </h3>
        <div class="space-y-3 text-sm">
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <div>
              <div class="font-medium text-gray-800">products_batch_1.csv</div>
              <div class="text-gray-500">25 products • 2 hours ago</div>
            </div>
            <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">Success</span>
          </div>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <div>
              <div class="font-medium text-gray-800">electronics.csv</div>
              <div class="text-gray-500">150 products • 1 day ago</div>
            </div>
            <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">Success</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const fileInput = document.getElementById('fileInput');
  const fileInfo = document.getElementById('fileInfo');
  const fileName = document.getElementById('fileName');
  const fileSize = document.getElementById('fileSize');

  fileInput.addEventListener('change', function(e) {
    if (e.target.files.length > 0) {
      const file = e.target.files[0];
      fileName.textContent = file.name;
      fileSize.textContent = formatFileSize(file.size);
      fileInfo.classList.remove('hidden');
    }
  });

  function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }

  window.clearFile = function() {
    fileInput.value = '';
    fileInfo.classList.add('hidden');
  };
});
</script>

<%- include('../partials/footer.ejs') %>